import { createI18n } from 'vue-i18n'

export const supportedLocales = ['en', 'nl', 'fr', 'de', 'ru'] as const
export type SupportedLocale = (typeof supportedLocales)[number]

const STORAGE_KEY = 'lrcom-locale'

function normalizeLocale(raw: string | null | undefined): SupportedLocale | null {
  const s = (raw ?? '').trim().toLowerCase()
  if (!s) return null

  // Accept exact match
  if ((supportedLocales as readonly string[]).includes(s)) return s as SupportedLocale

  // Accept prefixes like "de-DE" / "ru_RU"
  const base = s.split(/[-_]/)[0] ?? ''
  if ((supportedLocales as readonly string[]).includes(base)) return base as SupportedLocale

  return null
}

function detectInitialLocale(): SupportedLocale {
  try {
    const saved = normalizeLocale(sessionStorage.getItem(STORAGE_KEY))
    if (saved) return saved
  } catch {
    // ignore
  }

  const nav =
    normalizeLocale(navigator.language) ??
    normalizeLocale(Array.isArray(navigator.languages) ? navigator.languages[0] : null) ??
    null

  return nav ?? 'en'
}

const baseMessages = {
  en: {
    common: {
      about: 'About',
      manageKeys: 'Manage keys',
      shareLink: 'Share link',
      scanQr: 'Scan QR',
      back: 'Back',
      chat: 'Chat',
      close: 'Close',
      cancel: 'Cancel',
      proceed: 'Proceed',
      reply: 'Reply',
      send: 'Send',
      settings: 'Settings',
      users: 'Users',
      online: 'Online',
      busy: 'busy',
      language: 'Language',
      unreadMessages: 'Unread messages',
      logout: 'Logout',
      edit: 'Edit',
      delete: 'Delete',
      save: 'Save',
      modified: 'modified',
      copy: 'Copy',
    },
    toast: {
      chatSendFailedTitle: 'Message not sent',
      chatSendFailedBody: "Couldn't reach the server. Please check your connection and try again.",
      chatTooLargeTitle: 'Message not sent',
      chatTooLargeBody: 'Message is too large to send.',
      introvertTitle: 'Cannot add user',
      introvertBody:
        'This is in introvert mode and he can not be added. If it your friend ask him to create a chat, or disaple introvert mode',
      copiedTitle: 'Copied',
      copiedBody: 'Message copied to clipboard.',
      copyFailedTitle: 'Copy failed',
      copyFailedBody: 'Could not copy message to clipboard.',
    },
    setup: {
      subtitle: 'Anonymous, encrypted voice web messenger with no registration and no chat history.',
      yourName: 'Your name',
      namePlaceholder: 'e.g. Alex',
      join: 'Join',
    },
    shareLink: {
      hint: 'Share this link to let someone create a private chat with you after they sign in.',
      linkLabel: 'Link',
    },

    scanQr: {
      hint: 'Scan an invite QR code to add the user immediately.',
      cameraUnavailable: 'No camera available on this device.',
      cameraPermissionDenied: 'Camera permission denied. Please allow camera access and try again.',
      cameraStartFailed: 'Could not start the camera.',
      invalidInvite: 'This QR code is not a valid invite link for this site.',
      addFailedTitle: 'Cannot add user',
    },
    signed: {
      keys: {
        title: 'Manage keys',
        description:
          'Back up your encrypted keys to move your account to another device or to keep a safe copy.\n\nThis file contains encrypted key material stored in your browser. Do not share it.',
        countOnDevice: 'Keys on this device: {count}',
        download: 'Download',
        downloadUser: 'Download {username} key',
        downloadAll: 'Download all keys',
        downloadSpecific: 'Download a specific key',
        addFromFile: 'Add key(s) from file',
        removeAll: 'Remove all local keys',
        downloadAllOk: 'Downloaded {count} key(s).',
        downloadOneOk: 'Downloaded key.',
        importBadFormat: 'Invalid file format. Expected a JSON key entry or array of key entries.',
        importResult: 'Read: {read}. Added: {added}. Ignored (already exists): {ignored}. Invalid: {invalid}.',
        specificHint: 'Enter username and password to locate a matching encrypted entry. This does not log you in.',
        specificMissing: 'Username and password required.',
        specificNotFound: 'No matching key found (username/password mismatch).',
        removeConfirm:
          'This will permanently and irrecoverably delete ALL local keys for {count} account(s) created/imported on this device.\n\nYou will be logged out.',
        removeAllConfirm: 'Remove all keys',
        removeAllOk: 'All local keys removed.',
      },
      subtitle: 'Your own private messenger. Fully encrypted, no logs, no traces.',
      username: 'Username',
      usernamePlaceholder: 'e.g. alice',
      password: 'Password',
      passwordPlaceholder: 'At least 8 characters',
      expirationDays: 'Account expiration (days)',
      expirationDaysSettingsHelp: 'Change after how many days of inactivity your account expires (stored encrypted).',
      expirationDaysRangeInfo: 'Accepted range: 7–365 days.',
      expirationDaysRangeError: 'Please enter a number between 7 and 365.',
      expirationDaysUnlockHint: 'Unlock your keys to change this setting.',
      register: 'Register',
      login: 'Login',
      stayLoggedIn: 'Stay logged in',
      stayLoggedInHelp: 'Stores your session on this device so you stay signed in after closing the app. Not recommended on shared devices.',
      autoUnlockOnDevice: 'Auto-unlock on this device',
      add: 'Add',
      switchAnonymous: 'Anonymous mode',
      unlockSubtitle: 'Unlock your private key to read and send messages.',
      unlockFor: 'Unlock for',
      unlock: 'Unlock',
      unlockFailed: 'Unlock failed.',
      chats: 'Chats',
      chat: 'Chat',
      addFriend: 'Add friend (username)',
      friendPlaceholder: 'Username',
      createChat: 'Create chat',
      filterShow: 'Show: {type}',
      filterAll: 'All',
      filterPrivate: 'Private',
      filterGroups: 'Groups',
      groupName: 'Group name',
      groupNamePlaceholder: 'e.g. Team',
      createGroup: 'Create group',
      addMember: 'Add member',
      memberPlaceholder: 'Username',
      memberAddedOk: 'Member added.',
      memberAlreadyInGroup: 'This user is already in this group.',
      membersList: 'Members list',
      membersLoading: 'Loading members…',
      noMembers: 'No members.',
      renameGroup: 'Rename group',
      renameGroupPlaceholder: 'New group name',
      renameGroupBadLength: 'Name must be 3–64 characters.',
      deleteChatWarning:
        'This will permanently delete this chat and remove all messages for both you and your friend. This cannot be undone.',
      leaveGroupRemoveMyMessagesWarning:
        'You will leave this group and all of your messages in it will be permanently deleted. This cannot be undone.',
      deleteGroup: 'Delete group',
      deleteGroupWarning:
        'You are the last member. This will permanently delete the group and remove all messages. This cannot be undone.',
      noChats: 'No chats yet. Add a friend by username.',
      youSignedInAs: 'Signed in as',
      hiddenMode: 'Hidden mode',
      hiddenModeHelp: 'When enabled, others will not see your online/busy status.',
      introvertMode: 'Introvert mode',
      introvertModeHelp:
        'When enabled, others cannot create new chats with you or add you to groups. Calls are only allowed for users who already share a private chat with you.',
      cannotChatWithSelf: 'You cannot create a private chat with yourself.',
      deleteAccount: 'Delete account',
      deleteAccountWarning:
        'This action is unrecoverable. Your account will be deleted and all of your messages in all chats will be permanently removed. This cannot be undone.',
      deleteChat: 'Delete chat',
      leaveGroup: 'Leave group',
      errInvalidCredentials: 'Invalid username or password.',
      errUsernameExists: 'Username already exists.',
      errUnauthorized: 'Session expired. Please log in again.',
      errNoLocalKey: 'No local key found for this user on this device. Use the correct password, or register again to create new keys.',
      errPasswordTooLong: 'Password must be at most {max} characters.',
      help: {
        usernameAria: 'Help: username',
        passwordAria: 'Help: password',
        expirationDaysAria: 'Help: account expiration',
        username:
          'Limitations: 3–64 characters.\nSecurity note: (fill later)\nTip: usernames are case-sensitive on login.',
        password:
          'Limitations: at least 8 characters.\nSecurity note: (fill later)\nTip: your password is used to decrypt your private key locally.',
        expirationDays:
          'Limitations: 7–365 days.\nSecurity note: (fill later)\nTip: activity extends expiration (with privacy jitter).',
      },
      entropy: {
        title: 'Entropy',
        instructions: 'Click 10 times on random places inside the field below.',
        hits: 'Hits: {hits}/{total}',
      },
      genericError: 'Something went wrong.',
    },
    about: {
      title: 'About',
      description:
        'TODO',
      repoLink: 'Git repository',
    },
    theme: {
      label: 'Theme: {mode}',
      system: 'System',
      dark: 'Dark',
      light: 'Light',
      toggleAria: 'Toggle theme',
    },
    settings: {
      title: 'Settings',
      youLabel: 'You:',
    },
    notifications: {
      settingsLabel: 'Notifications:',
      settingsHint: 'Enable notifications to get call/message alerts when the app is in background.',
      promptTitle: 'Enable notifications?',
      promptBody: 'Enable notifications to receive call and message alerts on your phone.',
      deniedBody: 'Notifications are blocked in your browser settings for this site.',
      enabledBody: 'Notifications are enabled.',
      unsupportedBody: 'Notifications are not supported in this browser.',
      enable: 'Enable notifications',
      notNow: 'Not now',
      state: {
        default: 'Not enabled',
        granted: 'Enabled',
        denied: 'Blocked',
      },
    },
    sidebar: {
      groupChat: 'Public chat',
      noOneOnline: 'No one online right now.',
    },
    chat: {
      typeMessage: 'Type a message...',
      replying: 'Replying',
      replyingTo: 'Replying to {name}',
      replyTo: 'Reply to {name}',
      joinOngoingTitle: 'Join ongoing call?',
      joinOngoingBodyNamed: "You are attempting to join {name}'s ongoing call.",
      joinOngoingBody: 'You are attempting to join an ongoing call.',
      callAria: 'Call',
      sendAria: 'Send',
    },
    call: {
      notInCall: 'Not in call',
      inCall: 'In call: {names}',
      incomingFromLabel: 'Incoming call from',
      incomingFrom: 'Incoming call from {name}',
      unknown: 'Unknown',
      waitingToJoinNamed: 'Waiting to join {name}…',
      waitingToJoin: 'Waiting to join…',
      requestingToJoinNamed: 'Requesting to join {name}…',
      requestingToJoin: 'Requesting to join…',
      calling: 'Calling…',
      callingNamed: 'Calling {name}…',
      ringing: 'Ringing…',
      ringingNamed: 'Ringing {name}…',
      inviting: 'Inviting…',
      connecting: 'Connecting…',
      connected: 'Connected',
      incomingCall: 'Incoming call',
      incomingCallNamed: 'Incoming call: {name}',
      callEnded: 'Call ended.',
      callRejected: 'Call rejected.',
      callFailed: 'Call failed: {reason}',
      introvertBlocked: 'Call blocked: user is in introvert mode.',
      joinFailed: 'Join failed.',
      joinFailedReason: 'Join failed: {reason}',
      from: 'From {name}',
      accept: 'Accept',
      reject: 'Reject',
      cancelRequest: 'Cancel request',
      addToCall: 'Add to call',
      hangUp: 'Hang up',
      joinRequestNamed: '{name} wants to join this call.',
      joinRequestSomeone: 'Someone wants to join this call.',
      micPermissionDenied: 'Microphone permission denied.',
      micNotFound: 'No microphone found.',
      micInUse: 'Microphone is in use.',
      micError: 'Microphone error.',
    },
    session: {
      enterName: 'Enter a name.',
      connecting: 'Connecting…',
      nameTaken: 'Name is taken.',
      invalidName: 'Invalid name.',
      disconnected: 'Disconnected.',
      connectionError: 'Connection error.',
      turn: 'TURN {host}',
      udpRelayPortsRatio: 'UDP relay ports ~{used}/{total}',
      udpRelayPortsTotal: 'UDP relay ports {total}',
      udpRelayPortsUsed: 'UDP relay ports in use ~{used}',
      estConfMax: 'est conf max ~{users} users',
      estCallsMax: 'est 1:1 max ~{calls} calls',
    },
    confirm: {
      leave: 'Logout and leave {appName}?',
      deleteAccount: 'Delete your account and all server-side history for {appName}? This cannot be undone.',
      deleteMessage: 'Delete this message?',
      deleteChat: 'Delete this chat for both users?',
      leaveGroup: 'Leave this group?',
    },
    lang: {
      en: 'English',
      nl: 'Nederlands',
      fr: 'Français',
      de: 'Deutsch',
      ru: 'Русский',
    },
  },

  nl: {
    common: {
      about: 'Over',
      manageKeys: 'Sleutels beheren',
      shareLink: 'Link delen',
      scanQr: 'QR scannen',
      back: 'Terug',
      chat: 'Chat',
      close: 'Sluiten',
      cancel: 'Annuleren',
      proceed: 'Doorgaan',
      reply: 'Antwoorden',
      send: 'Versturen',
      settings: 'Instellingen',
      users: 'Gebruikers',
      online: 'Online',
      busy: 'bezet',
      language: 'Taal',
      unreadMessages: 'Ongelezen berichten',
      logout: 'Uitloggen',
      edit: 'Bewerken',
      delete: 'Verwijderen',
      save: 'Opslaan',
      modified: 'bewerkt',
    },
    toast: {
      chatSendFailedTitle: 'Bericht niet verzonden',
      chatSendFailedBody: 'Kon de server niet bereiken. Controleer je verbinding en probeer het opnieuw.',
    },
    setup: {
      subtitle: 'Anonieme, versleutelde spraak-webmessenger zonder registratie en zonder chatgeschiedenis.',
      yourName: 'Jouw naam',
      namePlaceholder: 'bijv. Alex',
      join: 'Meedoen',
    },
    shareLink: {
      hint: 'Deel deze link zodat iemand na het inloggen een privéchat met je kan maken.',
      linkLabel: 'Link',
    },

    scanQr: {
      hint: 'Scan een uitnodigings-QR om de gebruiker direct toe te voegen.',
      cameraUnavailable: 'Geen camera beschikbaar op dit apparaat.',
      cameraPermissionDenied: 'Cameratoegang geweigerd. Sta toegang toe en probeer opnieuw.',
      cameraStartFailed: 'Kon de camera niet starten.',
      invalidInvite: 'Deze QR-code is geen geldige uitnodigingslink voor deze site.',
      addFailedTitle: 'Kan gebruiker niet toevoegen',
    },

    signed: {
      keys: {
        title: 'Sleutels beheren',
        description:
          'Maak een back-up van je versleutelde sleutels om je account naar een ander apparaat te verplaatsen of om een veilige kopie te bewaren.\n\nDit bestand bevat versleuteld sleutelmateriaal dat in je browser is opgeslagen. Deel het niet.',
        countOnDevice: 'Sleutels op dit apparaat: {count}',
        download: 'Downloaden',
        downloadUser: 'Sleutel van {username} downloaden',
        downloadAll: 'Alle sleutels downloaden',
        downloadSpecific: 'Een specifieke sleutel downloaden',
        addFromFile: 'Sleutel(s) uit bestand toevoegen',
        removeAll: 'Alle lokale sleutels verwijderen',
        downloadAllOk: '{count} sleutel(s) gedownload.',
        downloadOneOk: 'Sleutel gedownload.',
        importBadFormat: 'Ongeldig bestandsformaat. Verwacht een JSON-sleutelinvoer of een array met sleutelinvoeren.',
        importResult: 'Gelezen: {read}. Toegevoegd: {added}. Genegeerd (bestaat al): {ignored}. Ongeldig: {invalid}.',
        specificHint:
          'Voer gebruikersnaam en wachtwoord in om een overeenkomstige versleutelde invoer te vinden. Dit logt je niet in.',
        specificMissing: 'Gebruikersnaam en wachtwoord zijn verplicht.',
        specificNotFound: 'Geen overeenkomende sleutel gevonden (gebruikersnaam/wachtwoord komt niet overeen).',
        removeConfirm:
          'Dit verwijdert permanent en onherstelbaar ALLE lokale sleutels voor {count} account(s) die op dit apparaat zijn aangemaakt/geïmporteerd.\n\nJe wordt uitgelogd.',
        removeAllConfirm: 'Alle sleutels verwijderen',
        removeAllOk: 'Alle lokale sleutels verwijderd.',
      },
      subtitle: 'Je eigen privé-messenger. Volledig versleuteld, geen logs, geen sporen.',
      username: 'Gebruikersnaam',
      usernamePlaceholder: 'bijv. alice',
      password: 'Wachtwoord',
      passwordPlaceholder: 'Minstens 8 tekens',
      expirationDays: 'Accountverval (dagen)',
      expirationDaysSettingsHelp: 'Wijzig na hoeveel dagen inactiviteit je account verloopt (versleuteld opgeslagen).',
      expirationDaysRangeInfo: 'Toegestane bereik: 7–365 dagen.',
      expirationDaysRangeError: 'Voer een getal in tussen 7 en 365.',
      expirationDaysUnlockHint: 'Ontgrendel je sleutels om deze instelling te wijzigen.',
      register: 'Registreren',
      login: 'Inloggen',
      stayLoggedIn: 'Ingelogd blijven',
      stayLoggedInHelp: 'Slaat je sessie op dit apparaat op zodat je aangemeld blijft na het sluiten van de app. Niet aanbevolen op gedeelde apparaten.',
      autoUnlockOnDevice: 'Automatisch ontgrendelen op dit apparaat',
      youSignedInAs: 'Aangemeld als',
      hiddenMode: 'Verborgen modus',
      hiddenModeHelp: 'Wanneer ingeschakeld, zien anderen je online-/bezetstatus niet.',
      introvertMode: 'Introverte modus',
      introvertModeHelp:
        'Wanneer ingeschakeld, kunnen anderen geen nieuwe chats met je maken of je aan groepen toevoegen. Oproepen zijn alleen toegestaan voor gebruikers die al een privéchat met je delen.',
      errInvalidCredentials: 'Ongeldige gebruikersnaam of wachtwoord.',
      errUsernameExists: 'Gebruikersnaam bestaat al.',
      errUnauthorized: 'Sessie verlopen. Log opnieuw in.',
      errNoLocalKey:
        'Geen lokale sleutel gevonden voor deze gebruiker op dit apparaat. Gebruik het juiste wachtwoord, of registreer opnieuw om nieuwe sleutels te maken.',
      errPasswordTooLong: 'Wachtwoord mag maximaal {max} tekens zijn.',
      help: {
        usernameAria: 'Hulp: gebruikersnaam',
        passwordAria: 'Hulp: wachtwoord',
        expirationDaysAria: 'Hulp: accountverval',
        username:
          'Beperkingen: 3–64 tekens.\nBeveiligingsopmerking: (later invullen)\nTip: gebruikersnamen zijn hoofdlettergevoelig bij inloggen.',
        password:
          'Beperkingen: minimaal 8 tekens.\nBeveiligingsopmerking: (later invullen)\nTip: je wachtwoord wordt lokaal gebruikt om je privésleutel te ontsleutelen.',
        expirationDays:
          'Beperkingen: 7–365 dagen.\nBeveiligingsopmerking: (later invullen)\nTip: activiteit verlengt de vervaldatum (met privacy-jitter).',
      },
      entropy: {
        title: 'Entropie',
        instructions: 'Klik 10 keer op willekeurige plekken in het veld hieronder.',
        hits: 'Klikken: {hits}/{total}',
      },
      genericError: 'Er is iets misgegaan.',
      chats: 'Chats',
      chat: 'Chat',
      add: 'Toevoegen',
      addContact: 'Contact toevoegen',
      addFriend: 'Vriend toevoegen (gebruikersnaam)',
      friendPlaceholder: 'Gebruikersnaam',
      createChat: 'Chat maken',
      filterShow: 'Toon: {type}',
      filterAll: 'Alle',
      filterPrivate: 'Privé',
      filterGroups: 'Groepen',
      groupName: 'Groepsnaam',
      groupNamePlaceholder: 'bijv. Team',
      createGroup: 'Groep maken',
      noChats: 'Nog geen chats. Voeg een vriend toe op gebruikersnaam.',
      cannotChatWithSelf: 'Je kunt geen privéchat met jezelf maken.',
      deleteAccount: 'Account verwijderen',
      deleteAccountWarning:
        'Deze actie is onomkeerbaar. Je account wordt verwijderd en al je berichten in alle chats worden permanent verwijderd. Dit kan niet ongedaan worden gemaakt.',
      deleteChat: 'Chat verwijderen',
      leaveGroup: 'Groep verlaten',
      addMember: 'Lid toevoegen',
      memberPlaceholder: 'Gebruikersnaam',
      memberAddedOk: 'Lid toegevoegd.',
      memberAlreadyInGroup: 'Deze gebruiker zit al in deze groep.',
      membersList: 'Ledenlijst',
      membersLoading: 'Leden laden…',
      noMembers: 'Geen leden.',
      renameGroup: 'Groep hernoemen',
      renameGroupPlaceholder: 'Nieuwe groepsnaam',
      renameGroupBadLength: 'Naam moet 3–64 tekens zijn.',
      deleteChatWarning:
        'Dit verwijdert deze chat permanent en wist alle berichten voor zowel jou als je vriend. Dit kan niet ongedaan worden gemaakt.',
      leaveGroupRemoveMyMessagesWarning:
        'Je verlaat deze groep en al jouw berichten in deze groep worden permanent verwijderd. Dit kan niet ongedaan worden gemaakt.',
      deleteGroup: 'Groep verwijderen',
      deleteGroupWarning:
        'Je bent de laatste deelnemer. Dit verwijdert de groep permanent en wist alle berichten. Dit kan niet ongedaan worden gemaakt.',
    },
    about: {
      title: 'Over',
      description:
        'TODO',
      copy: 'Kopiëren',
      repoLink: 'Git-repository',
    },
    theme: {
      label: 'Thema: {mode}',
      system: 'Systeem',
      dark: 'Donker',
      light: 'Licht',
      copiedTitle: 'Gekopieerd',
      copiedBody: 'Bericht gekopieerd naar klembord.',
      copyFailedTitle: 'Kopiëren mislukt',
      copyFailedBody: 'Kon bericht niet naar klembord kopiëren.',
      toggleAria: 'Thema wisselen',
    },
    settings: {
      title: 'Instellingen',
      youLabel: 'Jij:',
    },
    notifications: {
      settingsLabel: 'Meldingen:',
      settingsHint: 'Schakel meldingen in om oproep-/berichtalerts te krijgen wanneer de app op de achtergrond staat.',
      promptTitle: 'Meldingen inschakelen?',
      promptBody: 'Schakel meldingen in om oproep- en berichtalerts op je telefoon te ontvangen.',
      deniedBody: 'Meldingen zijn geblokkeerd in de browserinstellingen voor deze site.',
      enabledBody: 'Meldingen zijn ingeschakeld.',
      unsupportedBody: 'Meldingen worden niet ondersteund in deze browser.',
      enable: 'Meldingen inschakelen',
      notNow: 'Niet nu',
      state: {
        default: 'Niet ingeschakeld',
        granted: 'Ingeschakeld',
        denied: 'Geblokkeerd',
      },
    },
    sidebar: {
      groupChat: 'Publieke chat',
      noOneOnline: 'Er is momenteel niemand online.',
    },
    chat: {
      typeMessage: 'Typ een bericht...',
      replying: 'Antwoorden',
      replyingTo: 'Antwoorden aan {name}',
      replyTo: 'Antwoorden aan {name}',
      joinOngoingTitle: 'Deelnemen aan lopend gesprek?',
      joinOngoingBodyNamed: 'Je probeert deel te nemen aan het lopende gesprek van {name}.',
      joinOngoingBody: 'Je probeert deel te nemen aan een lopend gesprek.',
      callAria: 'Bellen',
      sendAria: 'Versturen',
    },
    call: {
      notInCall: 'Niet in gesprek',
      inCall: 'In gesprek: {names}',
      incomingFromLabel: 'Inkomende oproep van',
      incomingFrom: 'Inkomende oproep van {name}',
      unknown: 'Onbekend',
      waitingToJoinNamed: 'Wachten om aan te sluiten bij {name}…',
      waitingToJoin: 'Wachten om aan te sluiten…',
      requestingToJoinNamed: 'Verzoek om aan te sluiten bij {name}…',
      requestingToJoin: 'Verzoek om aan te sluiten…',
      calling: 'Bellen…',
      callingNamed: 'Bellen {name}…',
      ringing: 'Overgaan…',
      ringingNamed: 'Overgaan bij {name}…',
      inviting: 'Uitnodigen…',
      connecting: 'Verbinden…',
      connected: 'Verbonden',
      incomingCall: 'Inkomende oproep',
      incomingCallNamed: 'Inkomende oproep: {name}',
      callEnded: 'Gesprek beëindigd.',
      callRejected: 'Oproep geweigerd.',
      callFailed: 'Oproep mislukt: {reason}',
      joinFailed: 'Deelnemen mislukt.',
      joinFailedReason: 'Deelnemen mislukt: {reason}',
      from: 'Van {name}',
      accept: 'Accepteren',
      reject: 'Weigeren',
      cancelRequest: 'Verzoek intrekken',
      addToCall: 'Aan gesprek toevoegen',
      hangUp: 'Ophangen',
      joinRequestNamed: '{name} wil deelnemen aan dit gesprek.',
      joinRequestSomeone: 'Iemand wil deelnemen aan dit gesprek.',
      micPermissionDenied: 'Microfoon-toestemming geweigerd.',
      micNotFound: 'Geen microfoon gevonden.',
      micInUse: 'Microfoon is in gebruik.',
      micError: 'Microfoonfout.',
    },
    session: {
      enterName: 'Voer een naam in.',
      connecting: 'Verbinden…',
      nameTaken: 'Naam is al in gebruik.',
      invalidName: 'Ongeldige naam.',
      disconnected: 'Verbinding verbroken.',
      connectionError: 'Verbindingsfout.',
      turn: 'TURN {host}',
      udpRelayPortsRatio: 'UDP relay-poorten ~{used}/{total}',
      udpRelayPortsTotal: 'UDP relay-poorten {total}',
      udpRelayPortsUsed: 'UDP relay-poorten in gebruik ~{used}',
      estConfMax: 'schatting: max. ~{users} gebruikers',
      estCallsMax: 'schatting: max. ~{calls} 1:1-gesprekken',
    },
    confirm: {
      leave: 'Uitloggen en {appName} verlaten?',
      deleteMessage: 'Dit bericht verwijderen?',
      deleteChat: 'Deze chat voor beide gebruikers verwijderen?',
      leaveGroup: 'Deze groep verlaten?',
    },
    lang: {
      en: 'English',
      nl: 'Nederlands',
      fr: 'Français',
      de: 'Deutsch',
      ru: 'Русский',
    },
  },

  fr: {
    common: {
      about: 'À propos',
      manageKeys: 'Gérer les clés',
      shareLink: 'Partager le lien',
      scanQr: 'Scanner QR',
      back: 'Retour',
      chat: 'Chat',
      close: 'Fermer',
      cancel: 'Annuler',
      proceed: 'Continuer',
      reply: 'Répondre',
      send: 'Envoyer',
      settings: 'Paramètres',
      users: 'Utilisateurs',
      online: 'En ligne',
      busy: 'occupé',
      language: 'Langue',
      unreadMessages: 'Messages non lus',
      logout: 'Déconnexion',
      edit: 'Modifier',
      delete: 'Supprimer',
      save: 'Enregistrer',
      modified: 'modifié',
    },
    setup: {
      subtitle: 'Messagerie vocale web anonyme et chiffrée, sans inscription ni historique de conversation.',
      yourName: 'Votre nom',
      namePlaceholder: 'ex. Alex',
      join: 'Rejoindre',
    },
    shareLink: {
      hint: 'Partagez ce lien pour permettre à quelqu’un de créer une discussion privée avec vous après connexion.',
      linkLabel: 'Lien',
    },

    scanQr: {
      hint: 'Scannez un QR d’invitation pour ajouter l’utilisateur immédiatement.',
      cameraUnavailable: 'Aucune caméra disponible sur cet appareil.',
      cameraPermissionDenied: 'Accès à la caméra refusé. Autorisez l’accès et réessayez.',
      cameraStartFailed: 'Impossible de démarrer la caméra.',
      invalidInvite: "Ce QR code n’est pas un lien d’invitation valide pour ce site.",
      addFailedTitle: "Impossible d’ajouter l’utilisateur",
    },

    signed: {
      keys: {
        title: 'Gérer les clés',
        description:
          'Sauvegardez vos clés chiffrées pour déplacer votre compte vers un autre appareil ou pour conserver une copie en lieu sûr.\n\nCe fichier contient du matériel de clés chiffré stocké dans votre navigateur. Ne le partagez pas.',
        countOnDevice: 'Clés sur cet appareil : {count}',
        download: 'Télécharger',
        downloadUser: 'Télécharger la clé de {username}',
        downloadAll: 'Télécharger toutes les clés',
        downloadSpecific: 'Télécharger une clé spécifique',
        addFromFile: 'Ajouter des clé(s) depuis un fichier',
        removeAll: 'Supprimer toutes les clés locales',
        downloadAllOk: '{count} clé(s) téléchargée(s).',
        downloadOneOk: 'Clé téléchargée.',
        importBadFormat: 'Format de fichier invalide. Attendu : une entrée de clé JSON ou un tableau d’entrées de clés.',
        importResult:
          'Lues : {read}. Ajoutées : {added}. Ignorées (déjà présentes) : {ignored}. Invalides : {invalid}.',
        specificHint:
          "Saisissez le nom d'utilisateur et le mot de passe pour trouver une entrée chiffrée correspondante. Cela ne vous connecte pas.",
        specificMissing: "Nom d'utilisateur et mot de passe requis.",
        specificNotFound: 'Aucune clé correspondante (nom d’utilisateur/mot de passe incorrect).',
        removeConfirm:
          'Cela supprimera définitivement et de manière irréversible TOUTES les clés locales pour {count} compte(s) créés/importés sur cet appareil.\n\nVous serez déconnecté(e).',
        removeAllConfirm: 'Supprimer toutes les clés',
        removeAllOk: 'Toutes les clés locales ont été supprimées.',
      },
      subtitle: 'Votre messagerie privée. Entièrement chiffrée, sans journaux, sans traces.',
      username: "Nom d'utilisateur",
      usernamePlaceholder: 'ex. alice',
      password: 'Mot de passe',
      passwordPlaceholder: 'Au moins 8 caractères',
      expirationDays: 'Expiration du compte (jours)',
      expirationDaysSettingsHelp: "Changez après combien de jours d'inactivité votre compte expire (stocké chiffré).",
      expirationDaysRangeInfo: 'Plage acceptée : 7–365 jours.',
      expirationDaysRangeError: 'Veuillez entrer un nombre entre 7 et 365.',
      expirationDaysUnlockHint: 'Déverrouillez vos clés pour modifier ce paramètre.',
      register: "S'inscrire",
      login: 'Se connecter',
      stayLoggedIn: 'Rester connecté',
      stayLoggedInHelp: 'Stocke votre session sur cet appareil afin de rester connecté après fermeture de l’application. Déconseillé sur un appareil partagé.',
      autoUnlockOnDevice: 'Déverrouillage automatique sur cet appareil',
      youSignedInAs: 'Connecté en tant que',
      hiddenMode: 'Mode invisible',
      hiddenModeHelp: 'Lorsque activé, les autres ne verront pas votre statut en ligne/occupé.',
      introvertMode: 'Mode introverti',
      introvertModeHelp:
        'Lorsque activé, les autres ne peuvent pas créer de nouvelles discussions avec vous ni vous ajouter à des groupes. Les appels sont autorisés uniquement pour les utilisateurs qui partagent déjà une discussion privée avec vous.',
      errInvalidCredentials: "Nom d'utilisateur ou mot de passe invalide.",
      errUsernameExists: "Ce nom d'utilisateur existe déjà.",
      errUnauthorized: 'Session expirée. Veuillez vous reconnecter.',
      errNoLocalKey:
        "Aucune clé locale trouvée pour cet utilisateur sur cet appareil. Utilisez le bon mot de passe, ou inscrivez-vous à nouveau pour créer de nouvelles clés.",
      errPasswordTooLong: 'Le mot de passe doit comporter au maximum {max} caractères.',
      help: {
        usernameAria: "Aide : nom d'utilisateur",
        passwordAria: 'Aide : mot de passe',
        expirationDaysAria: "Aide : expiration du compte",
        username:
          'Limites : 3–64 caractères.\nNote de sécurité : (à compléter)\nAstuce : les noms d’utilisateur sont sensibles à la casse à la connexion.',
        password:
          'Limites : au moins 8 caractères.\nNote de sécurité : (à compléter)\nAstuce : votre mot de passe sert à déchiffrer votre clé privée localement.',
        expirationDays:
          'Limites : 7–365 jours.\nNote de sécurité : (à compléter)\nAstuce : l’activité prolonge l’expiration (avec jitter de confidentialité).',
      },
      entropy: {
        title: 'Entropie',
        instructions: 'Cliquez 10 fois à des endroits aléatoires dans le champ ci-dessous.',
        hits: 'Clics : {hits}/{total}',
      },
      genericError: 'Une erreur est survenue.',
      chats: 'Discussions',
      chat: 'Discussion',
      add: 'Ajouter',
      addContact: 'Ajouter un contact',
      addFriend: "Ajouter un ami (nom d'utilisateur)",
      friendPlaceholder: "Nom d'utilisateur",
      createChat: 'Créer une discussion',
      filterShow: 'Afficher : {type}',
      filterAll: 'Tout',
      filterPrivate: 'Privé',
      filterGroups: 'Groupes',
      groupName: 'Nom du groupe',
      groupNamePlaceholder: 'ex. Équipe',
      createGroup: 'Créer un groupe',
      noChats: "Aucune discussion. Ajoutez un ami par nom d'utilisateur.",
      cannotChatWithSelf: "Vous ne pouvez pas créer une discussion privée avec vous-même.",
      deleteAccount: 'Supprimer le compte',
      deleteAccountWarning:
        "Cette action est irréversible. Votre compte sera supprimé et tous vos messages dans toutes les discussions seront définitivement effacés. Cela ne peut pas être annulé.",
      deleteChat: 'Supprimer la discussion',
      leaveGroup: 'Quitter le groupe',
      addMember: 'Ajouter un membre',
      memberPlaceholder: "Nom d'utilisateur",
      memberAddedOk: 'Membre ajouté.',
      memberAlreadyInGroup: 'Cet utilisateur est déjà dans ce groupe.',
      membersList: 'Liste des membres',
      membersLoading: 'Chargement des membres…',
      noMembers: 'Aucun membre.',
      renameGroup: 'Renommer le groupe',
      renameGroupPlaceholder: 'Nouveau nom du groupe',
      renameGroupBadLength: 'Le nom doit contenir 3 à 64 caractères.',
      deleteChatWarning:
        'Cela supprimera définitivement cette discussion et effacera tous les messages pour vous et votre ami. Cette action est irréversible.',
      leaveGroupRemoveMyMessagesWarning:
        'Vous allez quitter ce groupe et tous vos messages dans ce groupe seront définitivement supprimés. Cette action est irréversible.',
      deleteGroup: 'Supprimer le groupe',
      deleteGroupWarning:
        'Vous êtes le dernier membre. Cela supprimera définitivement le groupe et effacera tous les messages. Cette action est irréversible.',
    },
    about: {
      title: 'À propos',
      description:
        "TODO",
      repoLink: 'Dépôt Git',
    },
    theme: {
      label: 'Thème : {mode}',
      copy: 'Copier',
      system: 'Système',
      dark: 'Sombre',
      light: 'Clair',
      toggleAria: 'Changer le thème',
    },
    settings: {
      title: 'Paramètres',
      copiedTitle: 'Copié',
      copiedBody: 'Message copié dans le presse-papiers.',
      copyFailedTitle: 'Échec de la copie',
      copyFailedBody: "Impossible de copier le message dans le presse-papiers.",
      youLabel: 'Vous :',
    },
    notifications: {
      settingsLabel: 'Notifications :',
      settingsHint: "Activez les notifications pour recevoir des alertes d'appel/message quand l'app est en arrière-plan.",
      promptTitle: 'Activer les notifications ?',
      promptBody: "Activez les notifications pour recevoir des alertes d'appel et de message sur votre téléphone.",
      deniedBody: 'Les notifications sont bloquées dans les paramètres du navigateur pour ce site.',
      enabledBody: 'Les notifications sont activées.',
      unsupportedBody: 'Les notifications ne sont pas prises en charge par ce navigateur.',
      enable: 'Activer les notifications',
      notNow: 'Pas maintenant',
      state: {
        default: 'Non activées',
        granted: 'Activées',
        denied: 'Bloquées',
      },
    },
    sidebar: {
      groupChat: 'Chat public',
      noOneOnline: "Personne n’est en ligne pour le moment.",
    },
    chat: {
      typeMessage: 'Écrivez un message...',
      replying: 'En réponse',
      replyingTo: 'Réponse à {name}',
      replyTo: 'Réponse à {name}',
      joinOngoingTitle: "Rejoindre l'appel en cours ?",
      joinOngoingBodyNamed: "Vous essayez de rejoindre l'appel en cours de {name}.",
      joinOngoingBody: "Vous essayez de rejoindre un appel en cours.",
      callAria: 'Appeler',
      sendAria: 'Envoyer',
    },
    call: {
      notInCall: "Pas en appel",
      inCall: 'En appel : {names}',
      incomingFromLabel: 'Appel entrant de',
      incomingFrom: 'Appel entrant de {name}',
      unknown: 'Inconnu',
      waitingToJoinNamed: 'En attente pour rejoindre {name}…',
      waitingToJoin: 'En attente pour rejoindre…',
      requestingToJoinNamed: 'Demande pour rejoindre {name}…',
      requestingToJoin: 'Demande pour rejoindre…',
      calling: 'Appel…',
      callingNamed: 'Appel à {name}…',
      ringing: 'Sonnerie…',
      ringingNamed: 'Sonnerie chez {name}…',
      inviting: 'Invitation…',
      connecting: 'Connexion…',
      connected: 'Connecté',
      incomingCall: 'Appel entrant',
      incomingCallNamed: 'Appel entrant : {name}',
      callEnded: "Appel terminé.",
      callRejected: 'Appel refusé.',
      callFailed: "Échec de l'appel : {reason}",
      joinFailed: 'Échec pour rejoindre.',
      joinFailedReason: 'Échec pour rejoindre : {reason}',
      from: 'De {name}',
      accept: 'Accepter',
      reject: 'Refuser',
      cancelRequest: 'Annuler la demande',
      addToCall: "Ajouter à l'appel",
      hangUp: 'Raccrocher',
      joinRequestNamed: '{name} veut rejoindre cet appel.',
      joinRequestSomeone: "Quelqu'un veut rejoindre cet appel.",
      micPermissionDenied: 'Autorisation du micro refusée.',
      micNotFound: 'Aucun micro trouvé.',
      micInUse: 'Le micro est utilisé.',
      micError: 'Erreur du micro.',
    },
    session: {
      enterName: 'Entrez un nom.',
      connecting: 'Connexion…',
      nameTaken: 'Nom déjà pris.',
      invalidName: 'Nom invalide.',
      disconnected: 'Déconnecté.',
      connectionError: 'Erreur de connexion.',
      turn: 'TURN {host}',
      udpRelayPortsRatio: 'Ports relais UDP ~{used}/{total}',
      udpRelayPortsTotal: 'Ports relais UDP {total}',
      udpRelayPortsUsed: 'Ports relais UDP utilisés ~{used}',
      estConfMax: 'estimation : max ~{users} utilisateurs',
      estCallsMax: 'estimation : max ~{calls} appels 1:1',
    },
    confirm: {
      leave: 'Se déconnecter et quitter {appName} ?',
      deleteMessage: 'Supprimer ce message ?',
      deleteChat: 'Supprimer cette discussion pour les deux utilisateurs ?',
      leaveGroup: 'Quitter ce groupe ?',
    },
    lang: {
      en: 'English',
      nl: 'Nederlands',
      fr: 'Français',
      de: 'Deutsch',
      ru: 'Русский',
    },
  },

  de: {
    common: {
      about: 'Über',
      manageKeys: 'Schlüssel verwalten',
      shareLink: 'Link teilen',
      scanQr: 'QR scannen',
      back: 'Zurück',
      chat: 'Chat',
      close: 'Schließen',
      cancel: 'Abbrechen',
      proceed: 'Fortfahren',
      reply: 'Antworten',
      send: 'Senden',
      settings: 'Einstellungen',
      users: 'Nutzer',
      online: 'Online',
      busy: 'besetzt',
      language: 'Sprache',
      unreadMessages: 'Ungelesene Nachrichten',
      logout: 'Abmelden',
      modified: 'bearbeitet',
    },
    toast: {
      chatSendFailedTitle: 'Nachricht nicht gesendet',
      chatSendFailedBody: 'Server nicht erreichbar. Bitte Verbindung prüfen und erneut versuchen.',
    },
    setup: {
      subtitle: 'Anonymer, verschlüsselter Voice-Web-Messenger ohne Registrierung und ohne Chatverlauf.',
      yourName: 'Dein Name',
      namePlaceholder: 'z. B. Alex',
      join: 'Beitreten',
    },
    shareLink: {
      hint: 'Teile diesen Link, damit jemand nach dem Anmelden einen privaten Chat mit dir erstellen kann.',
      linkLabel: 'Link',
    },

    scanQr: {
      hint: 'Scanne einen Einladungs-QR, um den Nutzer sofort hinzuzufügen.',
      cameraUnavailable: 'Keine Kamera auf diesem Gerät verfügbar.',
      cameraPermissionDenied: 'Kamerazugriff verweigert. Bitte Zugriff erlauben und erneut versuchen.',
      cameraStartFailed: 'Kamera konnte nicht gestartet werden.',
      invalidInvite: 'Dieser QR-Code ist kein gültiger Einladungslink für diese Seite.',
      addFailedTitle: 'Nutzer kann nicht hinzugefügt werden',
    },
    signed: {
      keys: {
        title: 'Schlüssel verwalten',
        description:
          'Sichere deine verschlüsselten Schlüssel, um dein Konto auf ein anderes Gerät zu übertragen oder eine sichere Kopie aufzubewahren.\n\nDiese Datei enthält verschlüsseltes Schlüsselmaterial, das in deinem Browser gespeichert ist. Teile sie nicht.',
        countOnDevice: 'Schlüssel auf diesem Gerät: {count}',
        download: 'Herunterladen',
        downloadUser: 'Schlüssel von {username} herunterladen',
        downloadAll: 'Alle Schlüssel herunterladen',
        downloadSpecific: 'Einen bestimmten Schlüssel herunterladen',
        addFromFile: 'Schlüssel aus Datei hinzufügen',
        removeAll: 'Alle lokalen Schlüssel entfernen',
        downloadAllOk: '{count} Schlüssel heruntergeladen.',
        downloadOneOk: 'Schlüssel heruntergeladen.',
        importBadFormat:
          'Ungültiges Dateiformat. Erwartet wird ein JSON-Schlüsseleintrag oder ein Array von Schlüsseln.',
        importResult:
          'Gelesen: {read}. Hinzugefügt: {added}. Ignoriert (bereits vorhanden): {ignored}. Ungültig: {invalid}.',
        specificHint:
          'Gib Benutzername und Passwort ein, um einen passenden verschlüsselten Eintrag zu finden. Das meldet dich nicht an.',
        specificMissing: 'Benutzername und Passwort erforderlich.',
        specificNotFound: 'Kein passender Schlüssel gefunden (Benutzername/Passwort stimmt nicht).',
        removeConfirm:
          'Das löscht dauerhaft und unwiderruflich ALLE lokalen Schlüssel für {count} Konto/Konten, die auf diesem Gerät erstellt/importiert wurden.\n\nDu wirst abgemeldet.',
        removeAllConfirm: 'Alle Schlüssel entfernen',
        removeAllOk: 'Alle lokalen Schlüssel entfernt.',
      },
      subtitle: 'Dein eigener privater Messenger. Vollständig verschlüsselt, keine Logs, keine Spuren.',
      username: 'Benutzername',
      usernamePlaceholder: 'z. B. alice',
      password: 'Passwort',
      passwordPlaceholder: 'Mindestens 8 Zeichen',
      expirationDays: 'Kontoablauf (Tage)',
      expirationDaysSettingsHelp: 'Lege fest, nach wie vielen Tagen Inaktivität dein Konto abläuft (verschlüsselt gespeichert).',
      expirationDaysRangeInfo: 'Zulässiger Bereich: 7–365 Tage.',
      expirationDaysRangeError: 'Bitte gib eine Zahl zwischen 7 und 365 ein.',
      expirationDaysUnlockHint: 'Entsperre deine Schlüssel, um diese Einstellung zu ändern.',
      register: 'Registrieren',
      login: 'Anmelden',
      stayLoggedIn: 'Angemeldet bleiben',
      stayLoggedInHelp: 'Speichert deine Sitzung auf diesem Gerät, damit du nach dem Schließen der App angemeldet bleibst. Nicht empfohlen auf gemeinsam genutzten Geräten.',
      autoUnlockOnDevice: 'Automatisch auf diesem Gerät entsperren',
      youSignedInAs: 'Angemeldet als',
      hiddenMode: 'Versteckter Modus',
      hiddenModeHelp: 'Wenn aktiviert, sehen andere deinen Online-/Beschäftigt-Status nicht.',
      introvertMode: 'Introvertierter Modus',
      introvertModeHelp:
        'Wenn aktiviert, können andere keine neuen Chats mit dir erstellen oder dich zu Gruppen hinzufügen. Anrufe sind nur für Nutzer erlaubt, die bereits einen privaten Chat mit dir teilen.',
      errInvalidCredentials: 'Ungültiger Benutzername oder Passwort.',
      errUsernameExists: 'Benutzername existiert bereits.',
      errUnauthorized: 'Sitzung abgelaufen. Bitte erneut anmelden.',
      errNoLocalKey:
        'Kein lokaler Schlüssel für diesen Benutzer auf diesem Gerät gefunden. Verwende das richtige Passwort oder registriere dich erneut, um neue Schlüssel zu erstellen.',
      errPasswordTooLong: 'Passwort darf höchstens {max} Zeichen lang sein.',
      help: {
        usernameAria: 'Hilfe: Benutzername',
        passwordAria: 'Hilfe: Passwort',
        expirationDaysAria: 'Hilfe: Kontoablauf',
        username:
          'Einschränkungen: 3–64 Zeichen.\nSicherheitshinweis: (später ausfüllen)\nTipp: Benutzernamen sind beim Login case-sensitiv.',
        password:
          'Einschränkungen: mindestens 8 Zeichen.\nSicherheitshinweis: (später ausfüllen)\nTipp: Dein Passwort wird lokal genutzt, um deinen privaten Schlüssel zu entschlüsseln.',
        expirationDays:
          'Einschränkungen: 7–365 Tage.\nSicherheitshinweis: (später ausfüllen)\nTipp: Aktivität verlängert den Ablauf (mit Privacy-Jitter).',
      },
      entropy: {
        title: 'Entropie',
        instructions: 'Klicke 10-mal an zufällige Stellen im Feld unten.',
        hits: 'Klicks: {hits}/{total}',
      },
      genericError: 'Etwas ist schiefgelaufen.',
      chats: 'Chats',
      chat: 'Chat',
      add: 'Hinzufügen',
      addContact: 'Kontakt hinzufügen',
      addFriend: 'Freund hinzufügen (Benutzername)',
      friendPlaceholder: 'Benutzername',
      createChat: 'Chat erstellen',
      filterShow: 'Anzeigen: {type}',
      filterAll: 'Alle',
      filterPrivate: 'Privat',
      filterGroups: 'Gruppen',
      groupName: 'Gruppenname',
      groupNamePlaceholder: 'z. B. Team',
      createGroup: 'Gruppe erstellen',
      noChats: 'Noch keine Chats. Füge einen Freund per Benutzername hinzu.',
      cannotChatWithSelf: 'Du kannst keinen privaten Chat mit dir selbst erstellen.',
      deleteAccount: 'Konto löschen',
      deleteAccountWarning:
        'Diese Aktion ist unwiderruflich. Dein Konto wird gelöscht und alle deine Nachrichten in allen Chats werden dauerhaft entfernt. Das kann nicht rückgängig gemacht werden.',
      addMember: 'Mitglied hinzufügen',
      memberPlaceholder: 'Benutzername',
      memberAddedOk: 'Mitglied hinzugefügt.',
      memberAlreadyInGroup: 'Dieser Benutzer ist bereits in dieser Gruppe.',
      membersList: 'Mitgliederliste',
      membersLoading: 'Mitglieder werden geladen…',
      noMembers: 'Keine Mitglieder.',
      renameGroup: 'Gruppe umbenennen',
      renameGroupPlaceholder: 'Neuer Gruppenname',
      renameGroupBadLength: 'Name muss 3–64 Zeichen lang sein.',
      deleteChatWarning:
        'Dies löscht diesen Chat dauerhaft und entfernt alle Nachrichten für dich und deinen Freund. Das kann nicht rückgängig gemacht werden.',
      leaveGroupRemoveMyMessagesWarning:
        'Du verlässt diese Gruppe und alle deine Nachrichten darin werden dauerhaft gelöscht. Das kann nicht rückgängig gemacht werden.',
      deleteGroup: 'Gruppe löschen',
      deleteGroupWarning:
        'Du bist das letzte Mitglied. Das löscht die Gruppe dauerhaft und entfernt alle Nachrichten. Das kann nicht rückgängig gemacht werden.',
      deleteChat: 'Chat löschen',
      leaveGroup: 'Gruppe verlassen',
    },
    about: {
      title: 'Über',
      description:
        'TODO',
      repoLink: 'Git-Repository',
    },
    theme: {
      label: 'Thema: {mode}',
      system: 'System',
      copy: 'Kopieren',
      dark: 'Dunkel',
      light: 'Hell',
      toggleAria: 'Thema wechseln',
    },
      modified: 'bearbeitet',
    settings: {
      title: 'Einstellungen',
      copiedTitle: 'Kopiert',
      copiedBody: 'Nachricht in die Zwischenablage kopiert.',
      copyFailedTitle: 'Kopieren fehlgeschlagen',
      copyFailedBody: 'Nachricht konnte nicht in die Zwischenablage kopiert werden.',
      youLabel: 'Du:',
    },
    notifications: {
      settingsLabel: 'Benachrichtigungen:',
      settingsHint: 'Aktiviere Benachrichtigungen, um Anruf-/Nachrichtenhinweise im Hintergrund zu erhalten.',
      promptTitle: 'Benachrichtigungen aktivieren?',
      promptBody: 'Aktiviere Benachrichtigungen, um Anruf- und Nachrichtenhinweise auf deinem Handy zu erhalten.',
      deniedBody: 'Benachrichtigungen sind in den Browser-Einstellungen für diese Seite blockiert.',
      enabledBody: 'Benachrichtigungen sind aktiviert.',
      unsupportedBody: 'Benachrichtigungen werden in diesem Browser nicht unterstützt.',
      enable: 'Benachrichtigungen aktivieren',
      notNow: 'Nicht jetzt',
      state: {
        default: 'Nicht aktiviert',
        granted: 'Aktiviert',
        denied: 'Blockiert',
      },
    },
    sidebar: {
      groupChat: 'Öffentlicher Chat',
      noOneOnline: 'Im Moment ist niemand online.',
    },
    chat: {
      typeMessage: 'Nachricht schreiben...',
      replying: 'Antworten',
      replyingTo: 'Antwort an {name}',
      replyTo: 'Antwort an {name}',
      joinOngoingTitle: 'Einem laufenden Anruf beitreten?',
      joinOngoingBodyNamed: 'Du versuchst, dem laufenden Anruf von {name} beizutreten.',
      joinOngoingBody: 'Du versuchst, einem laufenden Anruf beizutreten.',
      callAria: 'Anrufen',
      sendAria: 'Senden',
    },
    call: {
      notInCall: 'Nicht im Anruf',
      inCall: 'Im Anruf: {names}',
      incomingFromLabel: 'Eingehender Anruf von',
      incomingFrom: 'Eingehender Anruf von {name}',
      unknown: 'Unbekannt',
      waitingToJoinNamed: 'Warten auf Beitritt zu {name}…',
      waitingToJoin: 'Warten auf Beitritt…',
      requestingToJoin: 'Beitritt anfragen…',
      calling: 'Rufe an…',
      callingNamed: 'Rufe {name} an…',
      ringing: 'Klingeln…',
      ringingNamed: 'Klingelt bei {name}…',
      inviting: 'Einladen…',
      connecting: 'Verbinden…',
      connected: 'Verbunden',
      incomingCall: 'Eingehender Anruf',
      incomingCallNamed: 'Eingehender Anruf: {name}',
      callEnded: 'Anruf beendet.',
      callRejected: 'Anruf abgelehnt.',
      callFailed: 'Anruf fehlgeschlagen: {reason}',
      joinFailed: 'Beitritt fehlgeschlagen.',
      joinFailedReason: 'Beitritt fehlgeschlagen: {reason}',
      from: 'Von {name}',
      accept: 'Annehmen',
      reject: 'Ablehnen',
      cancelRequest: 'Anfrage zurückziehen',
      addToCall: 'Zum Anruf hinzufügen',
      hangUp: 'Auflegen',
      joinRequestNamed: '{name} möchte diesem Anruf beitreten.',
      joinRequestSomeone: 'Jemand möchte diesem Anruf beitreten.',
      micPermissionDenied: 'Mikrofonberechtigung verweigert.',
      micNotFound: 'Kein Mikrofon gefunden.',
      micInUse: 'Mikrofon wird bereits verwendet.',
      micError: 'Mikrofonfehler.',
    },
    session: {
      enterName: 'Name eingeben.',
      connecting: 'Verbinden…',
      nameTaken: 'Name ist bereits vergeben.',
      invalidName: 'Ungültiger Name.',
      disconnected: 'Getrennt.',
      connectionError: 'Verbindungsfehler.',
      turn: 'TURN {host}',
      udpRelayPortsRatio: 'UDP-Relay-Ports ~{used}/{total}',
      udpRelayPortsTotal: 'UDP-Relay-Ports {total}',
      udpRelayPortsUsed: 'UDP-Relay-Ports in Benutzung ~{used}',
      estConfMax: 'Schätzung: max. ~{users} Nutzer',
      estCallsMax: 'Schätzung: max. ~{calls} 1:1-Anrufe',
    },
    confirm: {
      leave: '{appName} verlassen und abmelden?',
      leaveGroup: 'Diese Gruppe verlassen?',
    },
    lang: {
      en: 'English',
      nl: 'Nederlands',
      fr: 'Français',
      de: 'Deutsch',
      ru: 'Русский',
    },
  },

  ru: {
    common: {
      about: 'О приложении',
      manageKeys: 'Управление ключами',
      shareLink: 'Поделиться ссылкой',
      scanQr: 'Сканировать QR',
      back: 'Назад',
      chat: 'Чат',
      close: 'Закрыть',
      cancel: 'Отмена',
      proceed: 'Продолжить',
      reply: 'Ответить',
      send: 'Отправить',
      settings: 'Настройки',
      users: 'Пользователи',
      online: 'Онлайн',
      busy: 'занят',
      language: 'Язык',
      unreadMessages: 'Непрочитанные сообщения',
      logout: 'Выйти',
      edit: 'Редактировать',
      delete: 'Удалить',
      save: 'Сохранить',
      modified: 'изменено',
    },
    setup: {
      subtitle: 'Анонимный зашифрованный голосовой веб мессенджер без регистрации и хранения истории переписки',
      yourName: 'Ваше имя',
      namePlaceholder: 'напр. Алекс',
      join: 'Присоединиться',
    },
    shareLink: {
      hint: 'Поделитесь этой ссылкой, чтобы после входа пользователь смог создать с вами личный чат.',
      linkLabel: 'Ссылка',
    },

    scanQr: {
      hint: 'Отсканируйте QR-приглашение, чтобы сразу добавить пользователя.',
      cameraUnavailable: 'Камера недоступна на этом устройстве.',
      cameraPermissionDenied: 'Доступ к камере запрещён. Разрешите доступ и попробуйте снова.',
      cameraStartFailed: 'Не удалось запустить камеру.',
      invalidInvite: 'Этот QR-код не является действительной ссылкой-приглашением для этого сайта.',
      addFailedTitle: 'Не удалось добавить пользователя',
    },

    signed: {
      keys: {
        title: 'Управление ключами',
        description:
          'Сделайте резервную копию ваших зашифрованных ключей, чтобы перенести аккаунт на другое устройство или сохранить безопасную копию.\n\nЭтот файл содержит зашифрованный ключевой материал, сохранённый в вашем браузере. Не делитесь им.',
        countOnDevice: 'Ключи на этом устройстве: {count}',
        download: 'Скачать',
        downloadUser: 'Скачать ключ {username}',
        downloadAll: 'Скачать все ключи',
        downloadSpecific: 'Скачать конкретный ключ',
        addFromFile: 'Добавить ключ(и) из файла',
        removeAll: 'Удалить все локальные ключи',
        downloadAllOk: 'Скачано ключей: {count}.',
        downloadOneOk: 'Ключ скачан.',
        importBadFormat:
          'Неверный формат файла. Ожидается JSON-запись ключа или массив JSON-записей ключей.',
        importResult:
          'Прочитано: {read}. Добавлено: {added}. Пропущено (уже есть): {ignored}. Неверных: {invalid}.',
        specificHint:
          'Введите имя пользователя и пароль, чтобы найти подходящую зашифрованную запись. Это не выполняет вход.',
        specificMissing: 'Требуются имя пользователя и пароль.',
        specificNotFound: 'Подходящий ключ не найден (имя пользователя/пароль не совпадают).',
        removeConfirm:
          'Это навсегда и безвозвратно удалит ВСЕ локальные ключи для {count} аккаунта(ов), созданных/импортированных на этом устройстве.\n\nВы будете разлогинены.',
        removeAllConfirm: 'Удалить все ключи',
        removeAllOk: 'Все локальные ключи удалены.',
      },
      subtitle: 'Ваш личный мессенджер. Полностью зашифрован, без логов и следов.',
      username: 'Имя пользователя',
      usernamePlaceholder: 'напр. alice',
      password: 'Пароль',
      passwordPlaceholder: 'Минимум 8 символов',
      expirationDays: 'Срок действия аккаунта (дни)',
      expirationDaysSettingsHelp: 'Измените, через сколько дней бездействия аккаунт истекает (хранится в зашифрованном виде).',
      expirationDaysRangeInfo: 'Допустимый диапазон: 7–365 дней.',
      expirationDaysRangeError: 'Введите число от 7 до 365.',
      expirationDaysUnlockHint: 'Разблокируйте ключи, чтобы изменить этот параметр.',
      register: 'Регистрация',
      login: 'Вход',
      stayLoggedIn: 'Оставаться в системе',
      stayLoggedInHelp: 'Сохраняет вашу сессию на этом устройстве, чтобы вы оставались вошли после закрытия приложения. Не рекомендуется на общих устройствах.',
      autoUnlockOnDevice: 'Авто-разблокировка на этом устройстве',
      youSignedInAs: 'Вы вошли как',
      hiddenMode: 'Скрытый режим',
      hiddenModeHelp: 'Если включено, другие не увидят ваш статус онлайн/занят.',
      introvertMode: 'Режим интроверта',
      introvertModeHelp:
        'Если включено, другие не смогут создавать с вами новые чаты или добавлять вас в группы. Звонки разрешены только пользователям, которые уже имеют с вами личный чат.',
      errInvalidCredentials: 'Неверное имя пользователя или пароль.',
      errUsernameExists: 'Имя пользователя уже существует.',
      errUnauthorized: 'Сессия истекла. Войдите снова.',
      errNoLocalKey:
        'Локальный ключ для этого пользователя на этом устройстве не найден. Используйте правильный пароль или зарегистрируйтесь снова, чтобы создать новые ключи.',
      errPasswordTooLong: 'Пароль должен быть не длиннее {max} символов.',
      help: {
        usernameAria: 'Справка: имя пользователя',
        passwordAria: 'Справка: пароль',
        expirationDaysAria: 'Справка: срок действия аккаунта',
        username:
          'Ограничения: 3–64 символа.\nПримечание по безопасности: (заполнить позже)\nПодсказка: регистр в имени пользователя важен при входе.',
        password:
          'Ограничения: минимум 8 символов.\nПримечание по безопасности: (заполнить позже)\nПодсказка: пароль используется локально для расшифровки вашего приватного ключа.',
        expirationDays:
          'Ограничения: 7–365 дней.\nПримечание по безопасности: (заполнить позже)\nПодсказка: активность продлевает срок действия (с приватным jitter).',
      },
      entropy: {
        title: 'Энтропия',
        instructions: 'Нажмите 10 раз в случайных местах внутри поля ниже.',
        hits: 'Нажатия: {hits}/{total}',
      },
      genericError: 'Что-то пошло не так.',
      chats: 'Чаты',
      chat: 'Чат',
      add: 'Добавить',
      addContact: 'Добавить контакт',
      addFriend: 'Добавить друга (имя пользователя)',
      friendPlaceholder: 'Имя пользователя',
      createChat: 'Создать чат',
      filterShow: 'Показать: {type}',
      filterAll: 'Все',
      filterPrivate: 'Личные',
      filterGroups: 'Группы',
      groupName: 'Название группы',
      groupNamePlaceholder: 'напр. Команда',
      createGroup: 'Создать группу',
      noChats: 'Пока нет чатов. Добавьте друга по имени пользователя.',
      cannotChatWithSelf: 'Нельзя создать личный чат с самим собой.',
      deleteAccount: 'Удалить аккаунт',
      deleteAccountWarning:
        'Это действие необратимо. Ваш аккаунт будет удалён, и все ваши сообщения во всех чатах будут удалены навсегда. Это нельзя отменить.',
      deleteChat: 'Удалить чат',
      leaveGroup: 'Выйти из группы',
      addMember: 'Добавить участника',
      memberPlaceholder: 'Имя пользователя',
      memberAddedOk: 'Участник добавлен.',
      memberAlreadyInGroup: 'Этот пользователь уже состоит в этой группе.',
      membersList: 'Список участников',
      membersLoading: 'Загрузка участников…',
      noMembers: 'Участников нет.',
      renameGroup: 'Переименовать группу',
      renameGroupPlaceholder: 'Новое название группы',
      renameGroupBadLength: 'Название должно быть длиной 3–64 символа.',
      deleteChatWarning:
        'Это навсегда удалит чат и удалит все сообщения как у вас, так и у вашего собеседника. Отменить это нельзя.',
      leaveGroupRemoveMyMessagesWarning:
        'Вы выйдете из этой группы, и все ваши сообщения в ней будут навсегда удалены. Отменить это нельзя.',
      deleteGroup: 'Удалить группу',
      deleteGroupWarning:
        'Вы — последний участник. Это навсегда удалит группу и все сообщения. Отменить это нельзя.',
    },
    about: {
      title: 'О приложении',
      description:
        'TODO',
      repoLink: 'Исходный код',
    },
    theme: {
      label: 'Тема: {mode}',
      copy: 'Копировать',
      system: 'Системная',
      dark: 'Тёмная',
      light: 'Светлая',
      toggleAria: 'Сменить тему',
    },
    settings: {
      title: 'Настройки',
      copiedTitle: 'Скопировано',
      copiedBody: 'Сообщение скопировано в буфер обмена.',
      copyFailedTitle: 'Не удалось скопировать',
      copyFailedBody: 'Не удалось скопировать сообщение в буфер обмена.',
      youLabel: 'Вы:',
    },
    notifications: {
      settingsLabel: 'Уведомления:',
      settingsHint: 'Включите уведомления, чтобы получать оповещения о звонках/сообщениях, когда приложение в фоне.',
      promptTitle: 'Включить уведомления?',
      promptBody: 'Включите уведомления, чтобы получать оповещения о звонках и сообщениях на телефоне.',
      deniedBody: 'Уведомления заблокированы в настройках браузера для этого сайта.',
      enabledBody: 'Уведомления включены.',
      unsupportedBody: 'Уведомления не поддерживаются в этом браузере.',
      enable: 'Включить уведомления',
      notNow: 'Не сейчас',
      state: {
        default: 'Не включены',
        granted: 'Включены',
        denied: 'Заблокированы',
      },
    },
    sidebar: {
      groupChat: 'Публичный чат',
      noOneOnline: 'В сети только вы.',
    },
    chat: {
      typeMessage: 'Введите сообщение...',
      replying: 'Ответ',
      replyingTo: 'Ответ для {name}',
      replyTo: 'Ответ для {name}',
      joinOngoingTitle: 'Присоединиться к текущему звонку?',
      joinOngoingBodyNamed: 'Вы пытаетесь присоединиться к текущему звонку {name}.',
      joinOngoingBody: 'Вы пытаетесь присоединиться к текущему звонку.',
      callAria: 'Позвонить',
      sendAria: 'Отправить',
    },
    call: {
      notInCall: 'Не в звонке',
      inCall: 'В звонке: {names}',
      incomingFromLabel: 'Входящий звонок от',
      incomingFrom: 'Входящий звонок от {name}',
      unknown: 'Неизвестно',
      waitingToJoinNamed: 'Ожидание подключения к {name}…',
      waitingToJoin: 'Ожидание подключения…',
      requestingToJoinNamed: 'Запрос на подключение к {name}…',
      requestingToJoin: 'Запрос на подключение…',
      calling: 'Звоним…',
      callingNamed: 'Звоним {name}…',
      ringing: 'Гудки…',
      ringingNamed: 'Гудки у {name}…',
      inviting: 'Приглашаем…',
      connecting: 'Подключаемся…',
      connected: 'Подключено',
      incomingCall: 'Входящий звонок',
      incomingCallNamed: 'Входящий звонок: {name}',
      callEnded: 'Звонок завершён.',
      callRejected: 'Звонок отклонён.',
      callFailed: 'Звонок не удался: {reason}',
      joinFailed: 'Не удалось присоединиться.',
      joinFailedReason: 'Не удалось присоединиться: {reason}',
      from: 'От {name}',
      accept: 'Принять',
      reject: 'Отклонить',
      cancelRequest: 'Отменить запрос',
      addToCall: 'Добавить в звонок',
      hangUp: 'Положить трубку',
      joinRequestNamed: '{name} хочет присоединиться к этому звонку.',
      joinRequestSomeone: 'Кто-то хочет присоединиться к этому звонку.',
      micPermissionDenied: 'Доступ к микрофону запрещён.',
      micNotFound: 'Микрофон не найден.',
      micInUse: 'Микрофон уже используется.',
      micError: 'Ошибка микрофона.',
    },
    session: {
      enterName: 'Введите имя.',
      connecting: 'Подключение…',
      nameTaken: 'Имя уже занято.',
      invalidName: 'Некорректное имя.',
      disconnected: 'Отключено.',
      connectionError: 'Ошибка подключения.',
      turn: 'TURN {host}',
      udpRelayPortsRatio: 'UDP relay-порты ~{used}/{total}',
      udpRelayPortsTotal: 'UDP relay-порты {total}',
      udpRelayPortsUsed: 'UDP relay-порты в использовании ~{used}',
      estConfMax: 'оценка: макс. ~{users} пользователей',
      estCallsMax: 'оценка: макс. ~{calls} звонков 1:1',
    },
    confirm: {
      leave: 'Выйти и покинуть {appName}?',
      deleteMessage: 'Удалить это сообщение?',
      deleteChat: 'Удалить этот чат для обоих пользователей?',
      leaveGroup: 'Выйти из этой группы?',
    },
    lang: {
      en: 'English',
      nl: 'Nederlands',
      fr: 'Français',
      de: 'Deutsch',
      ru: 'Русский',
    },
  },
} as const

type AnyRecord = any

function isPlainObject(v: unknown): v is AnyRecord {
  return Boolean(v) && typeof v === 'object' && !Array.isArray(v)
}

function mergeDeep(base: AnyRecord, override: AnyRecord): AnyRecord {
  const out: AnyRecord = { ...(base ?? {}) }
  for (const [k, v] of Object.entries(override ?? {})) {
    if (isPlainObject(v) && isPlainObject(base?.[k])) out[k] = mergeDeep(base[k], v)
    else out[k] = v
  }
  return out
}

// Ensure every locale has the full key spectrum.
// Any missing key falls back to English (without needing to duplicate text).
export const messages: Record<SupportedLocale, any> = {
  en: baseMessages.en,
  nl: mergeDeep(baseMessages.en, baseMessages.nl),
  fr: mergeDeep(baseMessages.en, baseMessages.fr),
  de: mergeDeep(baseMessages.en, baseMessages.de),
  ru: mergeDeep(baseMessages.en, baseMessages.ru),
}

export const i18n: any = createI18n({
  legacy: false,
  locale: detectInitialLocale(),
  fallbackLocale: 'en',
  warnHtmlMessage: false,
  messages,
} as any)

export function getLocale(): SupportedLocale {
  return normalizeLocale(String(i18n.global.locale.value)) ?? 'en'
}

export function setLocale(next: SupportedLocale) {
  i18n.global.locale.value = next
  try {
    sessionStorage.setItem(STORAGE_KEY, next)
  } catch {
    // ignore
  }
}

export function cycleLocale(): SupportedLocale {
  const cur = getLocale()
  const idx = supportedLocales.indexOf(cur)
  const next = supportedLocales[((idx >= 0 ? idx : -1) + 1) % supportedLocales.length] ?? 'en'
  setLocale(next)
  return next
}
